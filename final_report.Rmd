---
title: "Final Report"
author: "Hazel Ethier and Eva Gerstle"
date: "3/27/2018"
output: 
  pdf_document:
    number_sections: true
    toc: true
fontsize: 12pt
---

```{r include=FALSE, message=FALSE}
library(tidyverse)
library(ipumsr)
library(mosaic)
library(Stat2Data)
library(dplyr)
library(ggplot2)
setwd("~/Desktop")

project_ddi <- read_ipums_ddi("usa_00005.xml")
project_data <- read_ipums_micro(project_ddi, verbose = FALSE)

```

```{r, echo=FALSE}
project_data <- project_data %>%
  mutate(
    Northeast=if_else(REGION == 11 | REGION == 12, 1 ,0),
    Midwest=if_else(REGION == 21 | REGION == 22, 1, 0),
    South=if_else(REGION == 31 | REGION == 32 | REGION == 33,1,0),
    West=if_else(REGION == 41 | REGION == 42,1,0)
  ) %>%
  mutate(
    white=if_else(RACE == 1,1,0),
    black =if_else(RACE == 2,1,0),
    nativeamerican=if_else(RACE==3,1,0),
    asian=if_else(RACE==4 | RACE==5 | RACE==6,1,0),
    otherrace=if_else(RACE==7,1,0),
    twoormore=if_else(RACE==8 | RACE == 9,1,0)
  ) %>%
  mutate(
    CINETHH= as.factor(if_else(CINETHH == 1 | CINETHH == 2, 1,0))
  ) %>%
  mutate(
    FARM= as.factor(if_else(FARM == 2, 1,0))
  ) %>%
  mutate(
    SSMC= as.factor(if_else(SSMC == 1 | SSMC == 2, 1,0))
  ) %>%
  mutate(
    MULTGEN= as.factor(if_else(MULTGEN == 3, 1,0))
  ) %>%
  select(PERNUM, SERIAL, Northeast, Midwest, South, West, AGE, RACE, SSMC, FARM, CINETHH, MULTGEN, HHINCOME, NCHLT5, white, black, nativeamerican, asian, otherrace, twoormore, NUMPREC)
str(project_data, give.attr = FALSE)
```
#Introduction
Our model concludes that intergenerational household, defined as households with three or more generations living under the same roof, living in different regions of the United States, have statistically different incomes.

#Methods
Run likihood test with extra variables


In order to test our model, we removed our variables one at a time, and ran various nested F tests, finding that each time, the full model the tertiary model with the confounding variables included was needed.  Thus we interpreted our variables adjusting for race, internet access, same-sex relationship status, age, number of children under 5, and farm status.

#Results

##Primary Question 

```{r, echo= FALSE}
primarymodel <- glm(MULTGEN ~ West + Midwest + South + AGE + HHINCOME + NUMPREC + NCHLT5 + NUMPREC*NCHLT5 + FARM + black + nativeamerican + asian +otherrace + twoormore , family=binomial, data = project_data)
summary(primarymodel)
```
```{r}
exp(coef(primarymodel))
```
Primary and Secondary Model: logit(multigen households) = -6.556 + 0.01617West - 0.2607Midwest + 0.1161South + 0.01753Age - 0.0000006131HHIncome + 0.8208NUMPREC + 0.3983NCHLT5 - 0.9717Farm + 0.7618black + 0.5277nativeamerican +0.5699asian +0.2464otherrace +0.4827twoormore - 0.175NUMPREC*NCHLT5

\textbf{Northeast}:
The odds, on average, of a household in the Northeast has being intergenerational are 0.00142, controlling for the variables above.
The probability of a household in the Northeast being intergenerational is .1418%, adjusting for the variables above.
\textbf{West}:
The odds, on average, of a household in the West being intergenerational are .001445, adjusting for the variables above. 
A household in the West has, on average, 1.0163 times the odds of being intergenerational than a household in the Northeast, controlling for the variables above.
The probability of a household in the West being intergenerational .144265%, adjusting for the variables above.
\textbf{Midwest}:
The odds, on average, of a household in the Midwest being intergenerational are .001095, adjusting for the variables above. 
A household in the Midwest has, on average, 0.7705 times the odds of being intergenerational than a household in the Northeast, controlling for the variables above.
The probability of a household in the Midwest being intergenerational is .1094%, adjusting for the variables above.
\textbf{South}:
The odds, on average, of a household in the South being intergenerational is .001597, adjusting for the variables above.
A household in the South has, on average, 1.123 times the odds of being intergenerational than a household in the Northeast, controlling for the variables above.
The probability of a household in the South being intergenerational is .1594%, adjusting for the variables above.

Our multiple logistic regression with 3156472 degrees of freedom, gives us high z-values for the categorical variable region of 2.126, -30.796, and 16.388 and low p-values of 0.0335, <.001, and <.001 for West, Midwest, and South, respectively. Based on these low p-values (below our chosen alpha level of 0.05), we can reject the null hypothesis that there is no relationship between region and odds of being an intergenerational household. We have evidence that there is a statistically significant relationship between region and odds of an household being intergenerational, controlling for the set variables. 

##Secondary Question

For every increase of \$1 in total household income, on average, we see a change of 0.999999386900188 times the odds of living in a intergenerational household, adjusting for age, region, number of people, number of children under 5, living on a farm, race, and the interaction between number of people and number of people under 5. 

For an increase of \$100,000 of total household income, on average, the family is 6% less likely to be intergenerational compared to a family with who earns \$100,000 less, holding age, region, number of people, number of children under 5, living on a farm, race, and the interaction between number of people and number of people under 5 constant. 

Based on our multiple logistic regression with 3156472 degrees of freedom, we obtain a high z-value of -25.591 and p-value of <0.001 for the coefficient for household income. Since the p-value is below our alpha level of 0.05, we can reject our null hypothesis that there is no relationship between income and odds of a household being intergenerational. This test provides evidence that there is a statistically significant relationship between household income and odds of a household being intergenerational. 


##Tertiary Question
```{r, echo=FALSE}
tertiarydata <- project_data %>%
  filter(MULTGEN == 1)

modeltertiary <- lm(HHINCOME~NUMPREC + Midwest*NUMPREC + South*NUMPREC + West*NUMPREC + AGE + FARM + NCHLT5 + black*NUMPREC + nativeamerican*NUMPREC + asian*NUMPREC + otherrace*NUMPREC + twoormore*NUMPREC + CINETHH + SSMC, data=tertiarydata)
summary(modeltertiary)

```

In our regression analysis of our tertiary model, we found that the interaction terms between number of people living in the household and region are statistically significant, on 243181 degrees of freedom. With p-values below .05, we can conclude that the slopes of our linear regression (number of people predicating income within intergenerational households) vary by region. 

For an intergenerational household living in the Northeast, (Connecticut, Maine, Massachusetts, New Hampshire, Rhode Island, Vermont, New Jersey, New York, Pennsylvania), with 3 people (the minimum number required to have an intergenerational household), the predicted annual household income is \$50346.082. With each additional household member, in the Northeast, income is predicted to increase by $10386.652, adjusted for the variables above. 
Whereas for intergenerational household living in the Midwest (Illinois, Indiana, Michigan, Ohio, Wisconsin, Iowa, Kansas, Minnesota, Missouri, Nebraska, North Dakota, South Dakota) with 3 people, the predicted annual household income is \$37730.064. With each additional household member, income is predicated to raise by \$5856.693, adjusted for the variables above.
In the South, (Delaware, District of Columbia, Florida, Georgia, Maryland, North Carolina, South Carolina, Virginia, West Virginia, Alabama, Kentucky, Mississippi, Tennessee, Arkansas, Louisiana, Oklahoma, Texas) for intergenerational households with 3 people, the predicted annual household income is \$38528.84. With each additional household member, income is predicated to raise by \$5844.596, adjusted for the variables above. 
Out in the Western States (Arizona, Colorado, Idaho, Montana, Nevada, New Mexico, Utah, Wyoming, Alaska, California, Hawaii, Oregon, Washington), intergenerational households with 3 people have a predicated annual household income of \$42643.982, With each additional household member, income is predicated to raise by \$7931.779, adjusted for the variables above. 

#Discussion